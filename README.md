# testing_program
Данная программа позволяет автоматизировать процесс тестирования коры 4G с использованем библиотеки pyshark для обработки пакетов.
А также преобразования пакетов в словари. 
Скачайте файл prod.ipynb, в котором находится текст программы, и трейс test.pcap, в котором содержится sctp и s1ap обмен. 
Эти оба файла должны быть в одной папке. Далее запустите prod.ipynb. 

Принцип работы. 

1) Сначала мы импортируем все библиотеки, которые нам понадобятся для обработки пакетов - pyshark.
2) Далее нам необходимо прочитать пакеты из трейса test.pcap с фильтром по s1ap, sctp.
3) Также есть возможность рассмотреть подробное содержание каждой пакета по его номеру. Например, пакет с номером 34:
   
   {'per.extension_bit': 'False', 'per.choice_index': '0', 's1ap.S1AP_PDU': '0', 's1ap.initiatingMessage_element': 'initiatingMessage', 's1ap.procedureCode': '13', 'per.enum_index': '1', 's1ap.criticality': '1', 'per.open_type_length': '55', 's1ap.value_element': 'value', 's1ap.UplinkNASTransport_element': 'UplinkNASTransport', 'per.sequence_of_length': '5', 's1ap.protocolIEs': '5', '': 'Item 0: id-MME-UE-S1AP-ID', 's1ap.ProtocolIE_Field_element': 'ProtocolIE-Field', 's1ap.id': '0', 's1ap.MME_UE_S1AP_ID': '0', 's1ap.ENB_UE_S1AP_ID': '1', 'per.octet_string_length': '13', 's1ap.NAS_PDU': '27:52:0c:ed:64:02:07:43:00:03:52:00:c2', 'nas-eps.security_header_type': '2', 'gsm_a.L3_protocol_discriminator': '0x07', 'nas-eps.msg_auth_code': '0x520ced64', 'nas-eps.seq_no': '2', 'nas-eps.nas_msg_emm_type': '0x43', 'gsm_a.len': '3', 'nas-eps.emm.esm_msg_cont': '52:00:c2', 'nas-eps.bearer_id': '5', 'nas-eps.esm.proc_trans_id': '0', 'nas-eps.nas_msg_esm_type': '0xc2', 's1ap.EUTRAN_CGI_element': 'EUTRAN-CGI', 'per.optional_field_bit': 'False', 's1ap.pLMNidentity': '52:f0:20', 'e212.ecgi.mcc': '250', 'e212.ecgi.mnc': '02', 's1ap.CellIdentity': '0x0fffffff', 's1ap.TAI_element': 'TAI', 'e212.tai.mcc': '250', 'e212.tai.mnc': '02', 's1ap.tAC': '1'}
   
4) Далее мы настраиваем логический фильтр с отображением интересующих нас пакетов. В первую очередь мы получаем все пакеты s1ap с попытками аттача и сохраняем номер sctp сессии.
   По этому номеру сессии мы будем искать сообщение об успешном завершении аттача. Если попытки аттача легко фильтруются с помощью методов и функций, представленных в библиотеке pyshark, то
   обработка сообщений об успешном заверешнии аттача не может быть отфильтрована в рамках данной реализации. Поэтому мной было принятно решение преобразовать пакет в словарь, затем в список. 
   Проанализировав месторасположение элемента внутри пакета, было установлено, что интересующие поле находится под номером 23. Следовательно, если пакет с номером процедуры 13 в 23 поле будет содержать значение 0x43, то это будет означать успешное заверешние попытки аттача в рамках рассматриваемой sctp сессии. В результате будет выведено сообщение с указанием номера пакета и sctp сессии,
   где была попытка аттача. Также сообщение об успешном завершении аттача с номером пакета и сессии.  И последним сообщением будет общее кол-во попыток аттача в данном трейса и кол-во успешно завершенных:
   
   "Была попытка аттача, номер пакета  15  номер sctp сессии  0x0001
    Попытка аттача с sctp сессией  0x0001  завершилась успешно, номер пакета  34
    Была попытка аттача, номер пакета  44  номер sctp сессии  0x0001
    Попытка аттача с sctp сессией  0x0001  завершилась успешно, номер пакета  63
    За всё время было  2  попыток(ки) аттача
    Из них  2  попыток(ки) завершилось успешно"
